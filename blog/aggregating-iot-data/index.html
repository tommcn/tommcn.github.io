<!doctype html><html class=light lang=en><head><meta charset=utf-8><title>Aggregating IOT data</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=https://tomas.mcnamer.ca/plugins/slick/slick.css as=style onload='this.onload=null,this.rel="stylesheet"' rel=preload><link rel=stylesheet href=https://tomas.mcnamer.ca/plugins/slick/slick-theme.css as=style onload='this.onload=null,this.rel="stylesheet"' rel=preload><link rel=stylesheet href=https://tomas.mcnamer.ca/plugins/font-awesome/css/font-awesome.min.css as=font onload='this.onload=null,this.rel="stylesheet"' rel=preload><link rel=stylesheet href=https://tomas.mcnamer.ca/plugins/magnafic-popup/magnific-popup.css as=style onload='this.onload=null,this.rel="stylesheet"' rel=preload><link href=https://tomas.mcnamer.ca/scss/style.min.css rel=stylesheet as=style onload='this.onload=null,this.rel="stylesheet"' rel=preload><link rel="shortcut icon" href=https://tomas.mcnamer.ca/images/favicon.ico type=image/x-icon><link rel=icon href=https://tomas.mcnamer.ca/images/favicon.png type=image/x-icon><meta name=description content="Tomas McNamer's personal website"></head><body><nav class="navbar navbar-expand-lg fixed-top"><div class=container><a href=https://tomas.mcnamer.ca/ class=navbar-brand><img src=https://tomas.mcnamer.ca/images/site-navigation/logo.webp alt=site-logo></a>
<button type=button class="navbar-toggler collapsed" data-toggle=collapse data-target=#navbarCollapse aria-label="Collapse menu">
<span class=navbar-toggler-icon></span>
<span class=navbar-toggler-icon></span>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse justify-content-between" id=navbarCollapse><ul class="nav navbar-nav main-navigation my-0 mx-auto"><li class=nav-item><a href=https://tomas.mcnamer.ca/#home class="nav-link text-dark text-sm-center p-2">Home</a></li><li class=nav-item><a href=https://tomas.mcnamer.ca/#about class="nav-link text-dark text-sm-center p-2">About</a></li><li class=nav-item><a href=https://tomas.mcnamer.ca/#portfolio class="nav-link text-dark text-sm-center p-2">Portfolio</a></li><li class=nav-item><a href=https://tomas.mcnamer.ca/#resume class="nav-link text-dark text-sm-center p-2">Resume</a></li><li class=nav-item><a href=https://tomas.mcnamer.ca/#blog class="nav-link text-dark text-sm-center p-2">Blog</a></li><li class=nav-item><a href=https://tomas.mcnamer.ca/#contact class="nav-link text-dark text-sm-center p-2">Contact</a></li><li class=nav-item><button class=toggle-mode aria-label="Toggle dark mode"><i class="fa fa-moon-o"></i></button></li></ul></div></div></nav><div id=content><header class=breadCrumb><div class=container><div class=row><div class="col-lg-10 col-md-12 offset-lg-1 offset-md-0 text-center"><h3 class=breadCrumb__title>Aggregating IOT data</h3><nav aria-label=breadcrumb class="d-flex justify-content-center"><ol class="breadcrumb align-items-center"><li class=breadcrumb-item><a href=https://tomas.mcnamer.ca/>Home</a></li><li class=breadcrumb-item><a href=https://tomas.mcnamer.ca/blog>All Post</a></li><li class="breadcrumb-item active" aria-current=page>Aggregating IOT data</li></ol></nav></div></div><ul class=post-meta><li><i class="fa fa-calendar"></i>
October 24, 2021</li><li><i class="fa fa-clock-o"></i>
6 mins read</li><li><i class="fa fa-folder-open"></i>
<a class=text-capitalize href=https://tomas.mcnamer.ca/categories/blog/>blog</a></li><li><i class="fa fa-globe"></i>
<a class=text-capitalize href=https://tommcn.medium.com/aggregating-iot-data-2b6dcf541d5f>Read on Medium</a></li></ul></div></div></div></div></header><section class="section singleBlog"><div class=svg-img><img src=https://tomas.mcnamer.ca/images/hero/figure-svg.svg alt></div><div class=animate-shape><img src=https://tomas.mcnamer.ca/images/skill/skill-background-shape.svg alt><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 600 600"><defs><linearGradient id="d" x1=".929" y1=".111" x2=".263" y2=".935" gradientUnits="objectBoundingBox"><stop offset="0" stop-color="#f1f6f9"/><stop offset="1" stop-color="#f1f6f9" stop-opacity="0"/></linearGradient></defs><g data-name="blob-shape (3)"><path class="blob" fill="url(#d)" d="M455.4 151.1c43.1 36.7 73.4 92.8 60.8 136.3-12.7 43.5-68.1 74.4-111.3 119.4-43.1 45-74 104.1-109.8 109-35.9 5-76.7-44.2-111.8-89.2-35.2-45-64.7-85.8-70.8-132.6-6-46.8 11.6-99.6 46.7-136.3 35.2-36.6 88-57.2 142.4-58.8 54.5-1.7 110.6 15.6 153.8 52.2z"/></g></svg></div><div class=animate-pattern><img src=https://tomas.mcnamer.ca/images/service/background-pattern.svg alt=background-shape></div><div class=container><div class=row><div class=col-lg-12><div class=singleBlog__feature><img src=https://miro.medium.com/max/1400/0*qwpfdDzTL0rcjSxD alt=feature-image></div></div></div><div class="row mt-5"><div class=col-lg-12><div class=singleBlog__content><h3>Table of Contents</h3><nav id=TableOfContents><ul><li><a href=#my-solution>My Solution</a></li><li><a href=#how-i-built-it>How I built it</a></li><li><a href=#my-code>My code</a></li><li><a href=#examples>Examples</a></li><li><a href=#conclusion>Conclusion</a></li></ul></nav><h1 id=aggregating-iot-data>Aggregating IOT data</h1><p>Introduction</p><p>Data runs the world. Each day, <strong>2.5 million terabytes</strong> of data are created by humans (<a href=https://seedscientific.com/how-much-data-is-created-every-day>source</a>). The Internet Of Things (IOT) accounts for a huge portion of this statistic. The IOT is the collection of devices with embedded sensors and that collect and exchange data over the internet or similar protocols. IOT accounts for a large portion of the statistic mentioned above.</p><p><img src=https://cdn-images-1.medium.com/max/13440/0*qwpfdDzTL0rcjSxD alt="Photo by BENCE BOROS on Unsplash"><em>Photo by <a href="https://unsplash.com/@benceboros?utm_source=medium&utm_medium=referral">BENCE BOROS</a> on <a href="https://unsplash.com?utm_source=medium&utm_medium=referral">Unsplash</a></em></p><p>Making an IOT device is trivial. Using a Raspberry Pi or an Arduino and some sensors, anyone can build a device that checks temperature, humidity, movement… These types of project are cheap and are a great way for people to learn about programming and networking. But the power of IOT doesn’t stop there. IOT devices are used everywhere: boats, smart cars, farms, labs, oil rigs… With all this data being produced, we need to find a way to aggregate and analyze all of this data.</p><h2 id=my-solution>My Solution</h2><p>Some solutions exist to aggregate such data, the most notable of which is <a href=https://thingspeak.com/>ThingSpeak</a>. I set out to build a simplified clone of this service to learn about servers and data aggregation. I chose to only keep a subset of features which I found most useful.</p><p>My project (which I called ThingTotal) has a single goal: to receive and store data in a way that is easy to analyse and does so in an efficient way. I do so by providing users with “streams”, which are endpoints users can send their data too. “Streams” can be customized to verify the data is in an acceptable format using JSON schema, a tool that allows to annotate and validate JSON data. Each “stream” can have multiple “entries”, which are the individual pieces of data sent to the endpoint.</p><p><img src=https://cdn-images-1.medium.com/max/7262/0*blKq0yIpGN7nT3pb alt="Photo by Chris Liverani on Unsplash"><em>Photo by <a href="https://unsplash.com/@chrisliverani?utm_source=medium&utm_medium=referral">Chris Liverani</a> on <a href="https://unsplash.com?utm_source=medium&utm_medium=referral">Unsplash</a></em></p><h2 id=how-i-built-it>How I built it</h2><p>To build this project I used many amazing open source technologies. The server is built using <a href=https://github.com/django/django>Django</a>. Django provides many features, the most notable of which is its ORM (Object Relational Mapping). Django’s ORM provides a layer of abstraction over the database, allowing us to use python classes and function to interact with the database without having to worry about the queries at a database level. When used properly, ORMs allow for greater confidence in the code and remove many security risks, the most notable of which is SQL injections attacks.</p><p><img src=https://cdn-images-1.medium.com/max/2400/1*HVKOLLX7wprRbHTl2IPDcQ.png alt="Django logo"><em>Django logo</em></p><p>On top of Django, I used the <a href=https://github.com/encode/django-rest-framework>Django Rest Framework</a> (DRF), a framework that helps turn your Django server into a REST API. A REST (Representational State Transfer) API (Application Programming Interface) is, to put it simply, each entry in the database (called ressource) has its own unique URL (ex. <a href=https://example.com/articles/12>https://example.com/articles/12</a>) and operations on these ressources are done using very specific types of requests. DRF makes it very easy to keep track of what&rsquo;s going on and keep clean urls:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>GET &lt;https://example.com/api/streams&gt; -&gt; List all the streams
</span></span><span style=display:flex><span>POST &lt;https://example.com/api/streams&gt; -&gt; Create a new stream
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>GET &lt;https://example.com/api/streams/619b&gt; -&gt; List the stream with id 619b
</span></span><span style=display:flex><span>PUT &lt;https://example.com/api/streams/619b&gt; -&gt; Edit the stream with id 619b
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>GET &lt;https://example.com/api/streams/619b/entries&gt; -&gt; List all the entries for the stream with id 619b
</span></span><span style=display:flex><span>POST &lt;https://example.com/api/stream/619b/entries&gt; -&gt; Create a new entry for the stream with id 619b
</span></span></code></pre></div><p>An other unique feature of DRF is that it is able to automatically create what’s called an <a href=https://www.openapis.org/>OpenAPI</a> documentation file, which is a standard for documenting APIs. This makes it incredibly easy for teams to work together, where we could have one person working on the server (backend) and someone else working on the web page (frontend) and the designer would be able to see exactly how they should interact with the backend to get a specific ressource or utilize a certain feature.</p><p>Finally, for the database (the thing that stores all of the data) I decided to use a NoSQL database, namely <a href=https://www.mongodb.com/>MongoDB</a>. MongoDB is a NoSQL database, meaning the data isn’t stored in rows and columns (think excel spreadsheet). MongoDB stores data in “documents” which allows the program to store data as key-value pairs, which is closely linked to the way that the IOT information is received and sent.</p><p><img src=https://cdn-images-1.medium.com/max/2000/1*bQ9ODgAHWc3GVHTl_lw1DA.png alt="MongoDB logo"><em>MongoDB logo</em></p><h2 id=my-code>My code</h2><p>Here are the most important pieces of code. I wont go into all details of my code as they get somewhat complex, all of my code is available on <a href=https://github.com/tommcn/thingtotal>GitHub</a>.</p><p>Without questions the most important pieces of code are my models. A model is the class that defines how information is stored in the database.</p><p>I have 2 models. The first one is the model that stores my streams.</p><p><img src=https://cdn-images-1.medium.com/max/2484/1*W2yewbBGsv2Fy1MJEYl_jA.png alt="Django model for Streams"><em>Django model for Streams</em></p><p>It has many fields. The _id field is used to uniquely represent each stream. The name and description fields are self-explanatory, they each allow for strings of up to 100 characters to be stored. The fields property is where users can define the data that they will be sending to the server. This allows the program to validate the data sent. Finally, the created_at field store the date and time the stream for created.</p><p>And I have a model for entries:</p><p><img src=https://cdn-images-1.medium.com/max/2752/1*H4X1oE03ecD_jr9sbSBp3g.png alt="Django model for Entries"><em>Django model for Entries</em></p><p>This model is a bit more complex. The <code>_id</code> and <code>created_at</code> fields have the same purpose as in the Stream model. The stream field is what allows each entry to be linked to one Stream, it basically states that this entry is linked to that streams. It also allows us to then search the database for all entries that are linked to a specific Stream with ease and speed. The data field is where we store the data sent to the server from IOT devices. We also had a little piece of information, telling the program that when it needs to use the plural of Entry (for example in documentation), it should use &ldquo;entries&rdquo;, instead of the naive &ldquo;entrys&rdquo;.</p><h2 id=examples>Examples</h2><p><img src=https://cdn-images-1.medium.com/max/2000/1*O9P0sNmMitx0KPj4ScKgKQ.png alt="Create a stream"><em>Create a stream</em></p><p><img src=https://cdn-images-1.medium.com/max/2000/1*9zv3OKayVEiEzSyo3vzNtA.png alt="List streams"><em>List streams</em></p><p><img src=https://cdn-images-1.medium.com/max/2000/1*xF_i_TtfLoV0dnGpNPk4_A.png alt="Stream detail"><em>Stream detail</em></p><p><img src=https://cdn-images-1.medium.com/max/2000/1*GnuI7i4k6zQ1BpesjYzGlA.png alt="Add an entry to a stream"><em>Add an entry to a stream</em></p><p><img src=https://cdn-images-1.medium.com/max/2000/1*MucfMWk4IcgkT7tmYOvVTQ.png alt="List entries for a specific stream"><em>List entries for a specific stream</em></p><h2 id=conclusion>Conclusion</h2><p>Through this project, I learnt about the power and NoSQL databases when used correctly. I also discovered the true power of many tools I have used in the past, especially MongoDB and Django Rest Framework. This is a (very) simplified clone of <a href=https://thingspeak.com/>ThingSpeak</a>, a great tool that I have used many times in the past. <a href=https://youtu.be/1G8PSPte9xk>Here’s a video a made about this project</a>.</p><p><em>I hoped you liked this article. If you found this interesting, consider following me on Medium, subscribe to my <a href=https://tommcn.substack.com/>newsletter</a> or connect with me on <a href=https://www.linkedin.com/in/tomas-mc/>LinkedIn</a>.</em></p></div></div></div></div></section></div><section class=footer id=contact><div class=footer__background_shape><svg viewBox="0 0 1920 79"><path d="M0 0h1920v79L0 0z" data-name="Path 1450"/></svg></div><div class=container><div class=row><div class=col-lg-12><div class=footer__cta><div class=shape-1><svg xmlns="http://www.w3.org/2000/svg" width="357" height="315.029" viewBox="0 0 357 315.029"><path data-name="Path 1449" d="M76.1-157.222C91.746-135.8 87.2-94.273 99.993-61.945c12.7 32.328 42.661 55.459 39.248 73.282-3.318 17.823-40.007 30.337-65.6 43.325-25.5 12.988-39.912 26.545-60.01 42.566-20.1 16.116-46.074 34.6-63.328 27.682-17.349-6.921-25.976-39.153-59.915-59.82s-93.1-29.768-105.325-51.478 22.373-56.028 43.609-93.949c21.331-37.921 29.2-79.35 53.563-96.793 24.459-17.444 65.414-10.9 103.9-6.921 38.396 3.982 74.326 5.404 89.965 26.829z" transform="translate(217.489 188.626)"/></svg></div><div class=shape-2><svg xmlns="http://www.w3.org/2000/svg" width="357" height="315.029" viewBox="0 0 357 315.029"><path data-name="Path 1449" d="M76.1-157.222C91.746-135.8 87.2-94.273 99.993-61.945c12.7 32.328 42.661 55.459 39.248 73.282-3.318 17.823-40.007 30.337-65.6 43.325-25.5 12.988-39.912 26.545-60.01 42.566-20.1 16.116-46.074 34.6-63.328 27.682-17.349-6.921-25.976-39.153-59.915-59.82s-93.1-29.768-105.325-51.478 22.373-56.028 43.609-93.949c21.331-37.921 29.2-79.35 53.563-96.793 24.459-17.444 65.414-10.9 103.9-6.921 38.396 3.982 74.326 5.404 89.965 26.829z" transform="translate(217.489 188.626)"/></svg></div><div class="text-light footer__cta_content"><span>Contact me</span><h2 class=mb-0>Let's Get in Touch</h2></div><div class=footer__cta_action><a class="btn btn-light btn-zoom" href=https://tomas.mcnamer.ca/contact>Get in
touch</a></div></div></div></div><div class="row footer__widget"><div class=col-lg-4><div class="footer__widget_logo mb-5"><img src=https://tomas.mcnamer.ca/images/favicon-1.png alt=widget-logo></div></div><div class=col-lg-4><div class="text-light footer__widget_sitemap mb-5"><h3 class=base-font>Sitemap</h3><ul class="unstyle-list small"><li class=mb-2><a class=text-light href=https://tomas.mcnamer.ca/contact>Contact me</a></li><li class=mb-2><a class=text-light href=https://tomas.mcnamer.ca/portfolio>Portfolio</a></li><li class=mb-2><a class=text-light href=https://tomas.mcnamer.ca/blog>Blog</a></li><li class=mb-2><a class=text-light href=https://tomas.mcnamer.ca/>Latest Article</a></li></ul></div></div><div class=col-lg-4><div class="text-light footer__widget_address mb-5"><h3 class=base-font>Contact</h3><ul class="fa-ul small"><li class=mb-2><a class=text-light href=tel:><span class=fa-li><i class="fa fa-phone"></i></span></a></li><li class=mb-2><a class=text-light href=mailto:tommcn@mcnamer.ca><span class=fa-li><i class="fa fa-envelope"></i></span>tommcn@mcnamer.ca</a></li></ul></div></div></div><div class="row footer__footer"><div class=col-lg-6><div class="footer__footer_copy text-light"><p>All right reserved copyright © Tomas McNamer 2022</p></div></div><div class=col-lg-6><div class=footer__footer_social><ul class=unstyle-list><li class="d-inline-block mx-2"><a class=text-light target=_blank href=https://www.linkedin.com/in/tomas-mc aria-label="Social link"><i class="fa fa-linkedin-square"></i></a></li><li class="d-inline-block mx-2"><a class=text-light target=_blank href=https://github.com/tommcn aria-label="Social link"><i class="fa fa-github-square"></i></a></li><li class="d-inline-block mx-2"><a class=text-light target=_blank href=mailto:tommcn@mcnamer.ca aria-label="Social link"><i class="fa fa-envelope-square"></i></a></li></ul></div></div></div></div></section><script src=https://tomas.mcnamer.ca/plugins/jQuery/jquery.min.js></script>
<script src=https://tomas.mcnamer.ca/plugins/bootstrap/bootstrap.min.js defer></script>
<script src=https://tomas.mcnamer.ca/plugins/slick/slick.min.js defer></script>
<script src=https://tomas.mcnamer.ca/plugins/waypoint/jquery.waypoints.min.js defer></script>
<script src=https://tomas.mcnamer.ca/plugins/magnafic-popup/jquery.magnific-popup.min.js defer></script>
<script src=https://tomas.mcnamer.ca/plugins/gsap/gsap.min.js defer></script>
<script src=https://tomas.mcnamer.ca/plugins/imagesloaded/imagesloaded.min.js defer></script>
<script src=https://tomas.mcnamer.ca/plugins/masonry/masonry.min.js defer></script>
<script src=https://tomas.mcnamer.ca/js/form-handler.min.js></script>
<script src=https://tomas.mcnamer.ca/js/script.min.js></script></body></html>